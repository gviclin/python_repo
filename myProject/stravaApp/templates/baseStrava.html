{% load static %}

<html>
	<style>

	</style>
    <head>
		<html lang="en">
	    <title>Statistics</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<link href='//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
				
				
        <!--link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"-->
        <!--link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"-->
		
		<!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="{% static 'css/strava.css' %}">
    </head>
	<body>
	
	<div class="navbar">
	  <a id="monthLink">By month</a>
	  <a id="yearLink">Year progression</a>
	  <div class="dropdown" style="float:right;">
		<button class="dropbtn" id="loginLink">Login 
		  <i class="fa fa-caret-down"></i>
		</button>
		<div class="dropdown-content">
		  <a id="settingLink">Setting</a>
		  <a id="logoutLink">Logout</a>
		</div>
	  </div> 
	</div>

	<!--h1><a href="/">Statistics</a></h1-->
			
		<!-- checkbox list-->
		<section>
		<div class="typeClass">
			<label  style="word-wrap:break-word">
				<input id="run"  type="checkbox" value="Run" />Run
			</label>
			<label  style="word-wrap:break-word">
				<input id="ride"  type="checkbox" value="Ride" />Ride
			</label>
		</div>			
		</section>
		
		<section>
			<div class="log">
			<p id="testgv"></p>
			</div>
		</section>

		<section>
			<div class="content" id="id_content">
				{% block content %}
				{% endblock %}
			</div>
		</section>
		
	</body>

</html>

<script type='text/javascript'>



 $(document).ready(function(){
 
	// Store the page type
	{% if actif == 1 %}sessionStorage.setItem("pageType", "month");{% endif %}
	{% if actif == 2 %}sessionStorage.setItem("pageType", "year");{% endif %}
	{% if actif == 3 %}sessionStorage.setItem("pageType", "login");{% endif %}
	
	updateMenu();
	
	$("#run").prop("checked", true);
	
	//Trigger defaut pageType
	{% if actif != 3 %}
	sendPostMessage(GetActivityType(), sessionStorage.getItem("pageType"));
	{% endif %}
	
	$('#monthLink').css('cursor', 'pointer'); // 'default' to revert
	$('#yearLink').css('cursor', 'pointer'); // 'default' to revert
	$('#loginLink').css('cursor', 'pointer'); // 'default' to revert
 
 	$("#monthLink").click(function(){
		sessionStorage.setItem("pageType", "month");
		sendPostMessage(GetActivityType(), "month");
		updateMenu();
	});
	
	$("#yearLink").click(function(){
		sessionStorage.setItem("pageType", "year");
		sendPostMessage(GetActivityType(), "year");	
		updateMenu();
	});
	
	$("#loginLink").click(function(){
		sessionStorage.setItem("pageType", "login");
		
		// callback link from strava depends on DEV / PROD mode 
		{% if  dev %}
		window.location.href = "http://www.strava.com/oauth/authorize?client_id=9402&response_type=code&redirect_uri=http://127.0.0.1:8000/login/&approval_prompt=force&scope=read,activity:read_all";
		{% else %}
		window.location.href = "http://www.strava.com/oauth/authorize?client_id=9402&response_type=code&redirect_uri=http://mypersonalstat.ddns.net/login/&approval_prompt=force&scope=read,activity:read_all";
		{% endif %}		
	});
	
	$("#settingLink").click(function(){
		sessionStorage.setItem("pageType", "setting");
		sendPostMessage(GetActivityType(), "setting");	
		updateMenu();
	});
	
	$("#logoutLink").click(function(){
		sessionStorage.setItem("pageType", "logout");
		sendPostMessage(GetActivityType(), "logout");	
		updateMenu();
	});
 
	$("#run").change(function(){
			$("#ride").prop("checked", false);			
			sendPostMessage(GetActivityType(), sessionStorage.getItem("pageType"));
	});

	$("#ride").change(function(){
			$("#run").prop("checked", false);	
			sendPostMessage(GetActivityType(), sessionStorage.getItem("pageType"))		
	});

 });
 
 function GetActivityType() {
	type=[];
	if ($('#run').is(":checked")) {
		type.push("run")
	}
	if ($('#ride').is(":checked")) {
		type.push("ride")		
	}
	return type
}
 
 function sendPostMessage(activityType, pageType) {
	// make POST ajax call
	$('html, body').css("cursor", "wait");
	$.ajax({
		type: 'POST',
		url: "{% url 'post_ajax' %}",
		data: "activityType=" + activityType + ";pageType=" + pageType,
		success: function (response) {
			//alert("ajax ok");	
			log = response["log"]
			data = response["data"]
	
			$("#testgv").text(function(i, origText){
			return log; 
			});
			
			//console.log(" data length : " +data.length);			
			
			$("#id_content").html(data);
			///document.getElementById("id_content").innerHTML = data; // dont work !!!
			
			$('html, body').css("cursor", "auto");
				
		}
	})

  return;
}


 function updateMenu() {
	if (sessionStorage.getItem("pageType") == "month")
	{
		$('#monthLink').css('background-color', '#858585');
		$('#yearLink').css('background-color', '#222');
		$('#loginLink').css('background-color', '#222');
		$('.listCheck').show();
	}
	else if (sessionStorage.getItem("pageType") == "year")
	{
		$('#yearLink').css('background-color', '#858585');
		$('#monthLink').css('background-color', '#222');
		$('#loginLink').css('background-color', '#222');
		$('.listCheck').show();
	}
	else if (sessionStorage.getItem("pageType") == "login")
	{
		$('#loginLink').css('background-color', '#858585');
		$('#monthLink').css('background-color', '#222');
		$('#yearLink').css('background-color', '#222');
		$('.listCheck').hide();
	}
}
 </script>