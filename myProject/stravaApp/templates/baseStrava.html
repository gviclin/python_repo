{% load static %}

<html>
	<style>

	</style>
    <head>
		<html lang="en">
	    <title>Statistics</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
        <link href='//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
				

				
        <!--link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"-->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="{% static 'css/strava.css' %}">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>
	<body>
		<div class="page-header">
			<div class="topnav">
				<a id="monthLink" class="menu_button">By month</a>
				<a id="yearLink" class="menu_button">Year progression</a>
			
			<div class="topnav-right">
				<a id="loginLink" class="menu_button" href="{% url 'viewLogin' %}">Login</a>
			</div></div>
		</div>
			<!--h1><a href="/">Statistics</a></h1-->
			
		<!-- checkbox list-->
		<section>
			<div class="cb">
				<div class="row">
					<div class="col">
						<div class="form-check">
							<input class="form-check-input" type="checkbox" value="Run" id="run">
							<label class="form-check-label" for="run">Run</label>
						</div>
					</div>
					<div class="form-check">
						<input class="form-check-input" type="checkbox" value="Ride" id="ride">
						<label class="form-check-label" for="ride">Ride</label>
					</div>
				</div>
			</div> 
		</section>
		
		<section>
			<div class="log">
			<p id="testgv"></p>
			</div>
		</section>

		<section>
			<div class="content" id="id_content">
				{% block content %}
				{% endblock %}
			</div>
		</section>
		
	</body>

</html>

<script type='text/javascript'>
{% if actif == 1 %}sessionStorage.setItem("statType", "month");{% endif %}
{% if actif == 2 %}sessionStorage.setItem("statType", "year");{% endif %}
{% if actif == 3 %}sessionStorage.setItem("statType", "login");{% endif %}


 $(document).ready(function(){
 
	//$(".menu_button").css("background-color","#ffffff");
	
	updateMenu();
	
	$("#run").prop("checked", true);
	
	//Trigger defaut statType
	{% if actif != 3 %}
	sendPostMessage(GetActivityType(), sessionStorage.getItem("statType"));
	{% endif %}
	
	$('#monthLink').css('cursor', 'pointer'); // 'default' to revert
	$('#yearLink').css('cursor', 'pointer'); // 'default' to revert
 
 	$("#monthLink").click(function(){
		sessionStorage.setItem("statType", "month");
		sendPostMessage(GetActivityType(), "month");
		updateMenu();
	});
	
	$("#yearLink").click(function(){
		sessionStorage.setItem("statType", "year");
		sendPostMessage(GetActivityType(), "year");	
		updateMenu();
	});
 
	$("#run").change(function(){
			$("#ride").prop("checked", false);
			
			sendPostMessage(GetActivityType(), sessionStorage.getItem("statType"));
			
			//alert("check run");		
			/*document.querySelector('#loginLink').click(); 
			/*$.get("http://127.0.0.1:8000/strava/byMonth/", { actType:"run"}, function( data ) {
			  $( ".result" ).html( data );
			  //alert( "Load was performed." );
			});*/	
	});

	$("#ride").change(function(){
			$("#run").prop("checked", false);
	
			sendPostMessage(GetActivityType(), sessionStorage.getItem("statType"))		
	});

 });
 
 function GetActivityType() {
	type=[];
	if ($('#run').is(":checked")) {
		type.push("run")
	}
	if ($('#ride').is(":checked")) {
		type.push("ride")		
	}
	return type
}
 
 function sendPostMessage(activityType, statType) {
	// make POST ajax call
	$('html, body').css("cursor", "wait");
	$.ajax({
		type: 'POST',
		url: "{% url 'post_ajax' %}",
		data: "activityType=" + activityType + ";statType=" + statType,
		success: function (response) {
			//alert("ajax ok");	
			log = response["log"]
			data = response["data"]
	
			$("#testgv").text(function(i, origText){
			return log; 
			});
			
			//console.log(" data length : " +data.length);			
			
			$("#id_content").html(data);
			///document.getElementById("id_content").innerHTML = data; // dont work !!!
			
			$('html, body').css("cursor", "auto");
				
		}
	})

  return;
}


 function updateMenu() {
	if (sessionStorage.getItem("statType") == "month")
	{
		$('#monthLink').css('background-color', '#858585');
		$('#yearLink').css('background-color', '#222');
		$('#loginLink').css('background-color', '#222');
	}
	else if (sessionStorage.getItem("statType") == "year")
	{
		$('#yearLink').css('background-color', '#858585');
		$('#monthLink').css('background-color', '#222');
		$('#loginLink').css('background-color', '#222');
	}
	else if (sessionStorage.getItem("statType") == "login")
	{
		$('#loginLink').css('background-color', '#858585');
		$('#monthLink').css('background-color', '#222');
		$('#yearLink').css('background-color', '#222');
	}
}
 </script>